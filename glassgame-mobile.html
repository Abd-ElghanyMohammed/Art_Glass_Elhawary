<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Art Glass Game - 3D Glass Breaker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background:
                radial-gradient(circle at 20% 20%, rgba(135, 206, 235, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(70, 130, 180, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 40% 60%, rgba(135, 206, 235, 0.1) 0%, transparent 50%),
                linear-gradient(135deg, #1a1a2e, #16213e, #0f0f23);
            color: white;
            overflow: hidden;
            height: 100vh;
            touch-action: none; /* Prevent default touch behaviors */
        }

        #gameContainer {
            width: 100%;
            height: 100vh;
            position: relative;
            touch-action: none;
        }

        #ui {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 10px;
            font-size: 24px;
            font-weight: bold;
        }

        #score {
            color: #00d4ff;
            font-size: 28px;
        }

        #instructions {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            max-width: 300px;
            font-size: 14px;
            line-height: 1.5;
        }

        #gameOver {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            display: none;
            z-index: 200;
        }

        #gameOver h2 {
            color: #ff6b6b;
            font-size: 36px;
            margin-bottom: 20px;
        }

        #finalScore {
            color: #00d4ff;
            font-size: 24px;
            margin-bottom: 20px;
        }

        button {
            background: linear-gradient(45deg, #00d4ff, #0099cc);
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
            transition: transform 0.2s;
            touch-action: manipulation;
        }

        button:hover {
            transform: scale(1.05);
        }

        .glass-shard {
            position: absolute;
            background: linear-gradient(45deg, #87ceeb, #4682b4);
            border-radius: 2px;
            pointer-events: none;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(180deg); }
        }

        .floating-glass {
            animation: float 3s ease-in-out infinite;
        }

        /* Mobile optimizations */
        @media (max-width: 768px) {
            #ui {
                font-size: 18px;
                padding: 15px;
                top: 10px;
                left: 10px;
            }

            #instructions {
                font-size: 12px;
                padding: 10px;
                bottom: 10px;
                right: 10px;
                max-width: 250px;
            }

            #gameOver {
                padding: 20px;
                width: 90%;
                max-width: 300px;
            }

            #gameOver h2 {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="ui">
            <div>Score: <span id="score">0</span></div>
            <div>Glasses Broken: <span id="glassesBroken">0</span></div>
        </div>

        <div id="instructions">
            <strong>كيفية اللعب:</strong><br>
            • اضغط في أي مكان لإطلاق كرة زجاجية<br>
            • الكاميرا تتحرك تلقائياً للأمام<br>
            • اكسر الألواح الزجاجية للحصول على نقاط<br>
            • كل لوح مكسور = 10 نقاط
        </div>

        <div id="gameOver">
            <h2>انتهت اللعبة!</h2>
            <div id="finalScore"></div>
            <button onclick="restartGame()">العب مرة أخرى</button>
            <button onclick="window.location.href='index.html'">العودة للرئيسية</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // Game variables
        let scene, camera, renderer, balls = [], glassPanels = [];
        let score = 0, glassesBroken = 0;
        let gameRunning = true;
        let cameraSpeed = 0.2; // Reduced speed for slower gameplay
        let ballSpeed = 0.8;
        let panelSpawnDistance = 50;

        // Initialize game
        function init() {
            // Scene setup
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0a0a0a);
            scene.fog = new THREE.Fog(0x0a0a0a, 50, 200);

            // Camera setup
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 5, 10);
            camera.lookAt(0, 0, 0);

            // Renderer setup
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.getElementById('gameContainer').appendChild(renderer.domElement);

            // Lighting
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 20, 10);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            scene.add(directionalLight);

            const pointLight = new THREE.PointLight(0x00d4ff, 1, 100);
            pointLight.position.set(0, 10, 0);
            scene.add(pointLight);

            // Ground
            const groundGeometry = new THREE.PlaneGeometry(100, 100);
            const groundMaterial = new THREE.MeshLambertMaterial({ color: 0x333333 });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);

            // Event listeners
            document.addEventListener('click', shootBall);
            document.addEventListener('touchstart', handleTouch, { passive: false });
            window.addEventListener('resize', onWindowResize);

            // Start game loop
            animate();
        }

        function shootBall(event) {
            if (!gameRunning) return;

            const ballGeometry = new THREE.SphereGeometry(0.3, 16, 16);
            const ballMaterial = new THREE.MeshPhysicalMaterial({
                color: 0x0088ff,
                transparent: true,
                opacity: 0.7,
                roughness: 0.1,
                metalness: 0.1,
                clearcoat: 1.0,
                clearcoatRoughness: 0.1
            });

            const ball = new THREE.Mesh(ballGeometry, ballMaterial);
            ball.position.copy(camera.position);
            ball.position.y -= 1;

            // Calculate direction based on click position
            const mouse = new THREE.Vector2();
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            const raycaster = new THREE.Raycaster();
            raycaster.setFromCamera(mouse, camera);

            const direction = raycaster.ray.direction.clone();
            ball.velocity = direction.multiplyScalar(ballSpeed);

            ball.castShadow = true;
            scene.add(ball);
            balls.push(ball);
        }

        function handleTouch(event) {
            if (!gameRunning) return;

            // Prevent default touch behavior
            event.preventDefault();

            // Get touch position
            const touch = event.touches[0] || event.changedTouches[0];
            const mouse = new THREE.Vector2();
            mouse.x = (touch.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(touch.clientY / window.innerHeight) * 2 + 1;

            const raycaster = new THREE.Raycaster();
            raycaster.setFromCamera(mouse, camera);

            const direction = raycaster.ray.direction.clone();

            // Create ball
            const ballGeometry = new THREE.SphereGeometry(0.3, 16, 16);
            const ballMaterial = new THREE.MeshPhysicalMaterial({
                color: 0x0088ff,
                transparent: true,
                opacity: 0.7,
                roughness: 0.1,
                metalness: 0.1,
                clearcoat: 1.0,
                clearcoatRoughness: 0.1
            });

            const ball = new THREE.Mesh(ballGeometry, ballMaterial);
            ball.position.copy(camera.position);
            ball.position.y -= 1;
            ball.velocity = direction.multiplyScalar(ballSpeed);

            ball.castShadow = true;
            scene.add(ball);
            balls.push(ball);
        }

        function createGlassPanel(position) {
            const panelGeometry = new THREE.BoxGeometry(4, 6, 0.2);
            const panelMaterial = new THREE.MeshPhysicalMaterial({
                color: 0x87ceeb,
                transparent: true,
                opacity: 0.8,
                roughness: 0.1,
                metalness: 0.1,
                clearcoat: 1.0,
                clearcoatRoughness: 0.1,
                side: THREE.DoubleSide
            });

            const panel = new THREE.Mesh(panelGeometry, panelMaterial);
            panel.position.copy(position);
            panel.position.y = 3;
            panel.castShadow = true;
            panel.receiveShadow = true;
            panel.health = 1; // Takes 1 hit to break
            panel.intact = true;

            scene.add(panel);
            glassPanels.push(panel);
            return panel;
        }

        function breakGlass(panel) {
            if (!panel.intact) return;

            panel.intact = false;
            score += 10;
            glassesBroken++;
            updateUI();

            // Create glass shards
            createGlassShards(panel.position);

            // Remove the panel after a short delay
            setTimeout(() => {
                scene.remove(panel);
                glassPanels = glassPanels.filter(p => p !== panel);
            }, 100);
        }

        function createGlassShards(position) {
            const shardCount = 8;

            for (let i = 0; i < shardCount; i++) {
                const shard = document.createElement('div');
                shard.className = 'glass-shard';
                shard.style.width = Math.random() * 20 + 10 + 'px';
                shard.style.height = Math.random() * 20 + 10 + 'px';
                shard.style.left = (window.innerWidth / 2 + (Math.random() - 0.5) * 100) + 'px';
                shard.style.top = (window.innerHeight / 2 + (Math.random() - 0.5) * 100) + 'px';

                document.getElementById('gameContainer').appendChild(shard);

                // Animate shard
                setTimeout(() => {
                    shard.style.transform = `translate(${ (Math.random() - 0.5) * 200 }px, ${ (Math.random() - 0.5) * 200 }px) rotate(${ Math.random() * 360 }deg)`;
                    shard.style.opacity = '0';
                }, 50);

                // Remove shard after animation
                setTimeout(() => {
                    if (shard.parentNode) {
                        shard.parentNode.removeChild(shard);
                    }
                }, 1000);
            }
        }

        function updateUI() {
            document.getElementById('score').textContent = score;
            document.getElementById('glassesBroken').textContent = glassesBroken;
        }

        function spawnGlassPanels() {
            // Spawn panels at random positions ahead of camera
            if (Math.random() < 0.02) { // 2% chance per frame
                const x = (Math.random() - 0.5) * 20;
                const z = camera.position.z - panelSpawnDistance;
                createGlassPanel(new THREE.Vector3(x, 0, z));
            }
        }

        function checkCollisions() {
            for (let i = balls.length - 1; i >= 0; i--) {
                const ball = balls[i];

                // Check collision with glass panels
                for (let j = glassPanels.length - 1; j >= 0; j--) {
                    const panel = glassPanels[j];

                    if (ball.position.distanceTo(panel.position) < 2.5) {
                        breakGlass(panel);
                        scene.remove(ball);
                        balls.splice(i, 1);
                        break;
                    }
                }

                // Remove balls that are too far behind
                if (ball.position.z < camera.position.z - 20) {
                    scene.remove(ball);
                    balls.splice(i, 1);
                }
            }
        }

        function animate() {
            requestAnimationFrame(animate);

            if (!gameRunning) return;

            // Move camera forward
            camera.position.z -= cameraSpeed;

            // Move balls
            balls.forEach(ball => {
                ball.position.add(ball.velocity);
            });

            // Spawn new panels
            spawnGlassPanels();

            // Check collisions
            checkCollisions();

            // Move panels with camera
            glassPanels.forEach(panel => {
                panel.position.z += cameraSpeed;
            });

            // Remove panels that are too far behind
            glassPanels = glassPanels.filter(panel => {
                if (panel.position.z > camera.position.z + 10) {
                    scene.remove(panel);
                    return false;
                }
                return true;
            });

            renderer.render(scene, camera);
        }

        function gameOver() {
            gameRunning = false;
            document.getElementById('finalScore').textContent = `النتيجة النهائية: ${score} نقطة`;
            document.getElementById('gameOver').style.display = 'block';
        }

        function restartGame() {
            // Reset game state
            score = 0;
            glassesBroken = 0;
            gameRunning = true;
            cameraSpeed = 0.2;

            // Clear existing objects
            balls.forEach(ball => scene.remove(ball));
            glassPanels.forEach(panel => scene.remove(panel));
            balls = [];
            glassPanels = [];

            // Reset camera
            camera.position.set(0, 5, 10);

            // Update UI
            updateUI();
            document.getElementById('gameOver').style.display = 'none';
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // Start the game when page loads
        window.addEventListener('load', init);

        // Add some floating glass elements for decoration
        function addFloatingGlasses() {
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    const glass = document.createElement('div');
                    glass.className = 'glass-shard floating-glass';
                    glass.style.width = '30px';
                    glass.style.height = '30px';
                    glass.style.left = Math.random() * window.innerWidth + 'px';
                    glass.style.top = Math.random() * window.innerHeight + 'px';
                    glass.style.background = 'linear-gradient(45deg, #87ceeb, #4682b4)';
                    glass.style.borderRadius = '50%';
                    glass.style.position = 'absolute';
                    glass.style.pointerEvents = 'none';
                    document.getElementById('gameContainer').appendChild(glass);
                }, i * 1000);
            }
        }

        // Call after game starts
        setTimeout(addFloatingGlasses, 1000);
    </script>
</body>
</html>
